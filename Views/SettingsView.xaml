<UserControl x:Class="Wolpope.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource SurfaceBrush}">
    <Border Padding="24" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" /> <!-- Column 1: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ -->
                <ColumnDefinition Width="40" /> <!-- Spacer -->
                <ColumnDefinition Width="*" /> <!-- Column 2: Ð¢ÐµÐ³Ð¸ Ð¸ ÐŸÐ¾Ð¸ÑÐº -->
            </Grid.ColumnDefinitions>

            <!-- Ð¡ÐµÐºÑ†Ð¸Ñ 1: ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="âš™ Settings" Foreground="White" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,16"/>
                    
                    <CheckBox Style="{StaticResource ToggleSwitchStyle}" Content="Pause when fullscreen app is running" IsChecked="{Binding PauseOnFullscreen}" Margin="0,0,0,12"/>
                    <CheckBox Style="{StaticResource ToggleSwitchStyle}" Content="Start with Windows" IsChecked="{Binding StartWithWindows}" Margin="0,0,0,12"/>
                    <CheckBox Style="{StaticResource ToggleSwitchStyle}" Content="Wait for active internet connection" Margin="0,0,0,12"/>
                    
                    <Border Height="1" Background="{StaticResource BorderBrush_}" Margin="0,16"/>

                    <!-- Ð¢Ð°Ð¹Ð¼ÐµÑ€ -->
                    <TextBlock Text="Timer Mode:" Foreground="{StaticResource SubtextBrush}" Margin="0,0,0,12"/>
                    <RadioButton Content="Interval" IsChecked="{Binding IsExactTimeMode, Converter={StaticResource InvBoolToVis}}" Margin="0,0,0,8" Foreground="{StaticResource TextBrush}"/>
                    <StackPanel Orientation="Horizontal" Margin="24,0,0,16" IsEnabled="{Binding IsExactTimeMode, Converter={StaticResource InvBoolToVis}}">
                        <TextBox Text="{Binding Interval}" Width="50" Margin="0,0,8,0" Background="{StaticResource CardBrush}" Foreground="White" BorderThickness="0" Padding="4" VerticalContentAlignment="Center"/>
                        <ComboBox SelectedIndex="{Binding IntervalUnitIndex}" Background="{StaticResource CardBrush}" Foreground="White" BorderThickness="0" Width="80">
                            <ComboBoxItem Content="Seconds"/>
                            <ComboBoxItem Content="Minutes"/>
                            <ComboBoxItem Content="Hours"/>
                        </ComboBox>
                    </StackPanel>

                    <RadioButton Content="Exact Time of Day" IsChecked="{Binding IsExactTimeMode}" Margin="0,0,0,8" Foreground="{StaticResource TextBrush}"/>
                    <StackPanel Margin="24,0,0,16" IsEnabled="{Binding IsExactTimeMode}">
                        <TextBox Text="{Binding ExactTime}" Width="100" HorizontalAlignment="Left" Background="{StaticResource CardBrush}" Foreground="White" BorderThickness="0" Padding="4" ToolTip="Format: HH:mm (e.g., 14:30)"/>
                        <TextBlock Text="If PC is off, wallpaper changes at startup." Foreground="{StaticResource SubtextBrush}" FontSize="11" Margin="0,4,0,0" TextWrapping="Wrap"/>
                    </StackPanel>

                    <Border Height="1" Background="{StaticResource BorderBrush_}" Margin="0,16"/>

                    <!-- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¾Ð² Ð¸ ÑÐºÑ€Ð°Ð½Ð° Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¸ -->
                    <TextBlock Text="Displays &amp; Lock Screen:" Foreground="{StaticResource SubtextBrush}" Margin="0,0,0,12"/>
                    
                    <StackPanel Visibility="{Binding CanUsePerMonitor, Converter={StaticResource BoolToVis}}">
                        <CheckBox Style="{StaticResource ToggleSwitchStyle}" Content="Separate wallpapers for each screen" IsChecked="{Binding IsPerMonitor}" Margin="0,0,0,12" Visibility="{Binding RandomForMonitors, Converter={StaticResource InvBoolToVis}}"/>
                        <CheckBox Style="{StaticResource ToggleSwitchStyle}" Content="Random wallpaper for each screen (shared tags)" IsChecked="{Binding RandomForMonitors}" Margin="0,0,0,12" Visibility="{Binding IsPerMonitor, Converter={StaticResource InvBoolToVis}}"/>
                    </StackPanel>

                    <CheckBox Style="{StaticResource ToggleSwitchStyle}" Content="Separate tags for lock screen" IsChecked="{Binding IsLockScreenSeparate}" Margin="0,0,0,12" Visibility="{Binding RandomForLockScreen, Converter={StaticResource InvBoolToVis}}"/>
                    <CheckBox Style="{StaticResource ToggleSwitchStyle}" Content="Random wallpaper for lock screen (shared tags)" IsChecked="{Binding RandomForLockScreen}" Margin="0,0,0,12" Visibility="{Binding IsLockScreenSeparate, Converter={StaticResource InvBoolToVis}}"/>

                    <!-- Ð’Ñ‹Ð±Ð¾Ñ€ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð° Ð´Ð»Ñ ÑÐºÑ€Ð°Ð½Ð° Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¸ -->
                    <StackPanel Margin="0,0,0,12">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding IsPerMonitor}" Value="True"/>
                                            <Condition Binding="{Binding IsLockScreenSeparate}" Value="False"/>
                                            <Condition Binding="{Binding RandomForLockScreen}" Value="False"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text="Lock screen source screen:" Foreground="{StaticResource SubtextBrush}" Margin="0,0,0,4"/>
                        <ComboBox ItemsSource="{Binding Monitors}" SelectedIndex="{Binding LockScreenMonitorIndex}" DisplayMemberPath="DisplayName" Background="{StaticResource CardBrush}" Foreground="White" BorderThickness="0"/>
                    </StackPanel>

                    <Border Height="1" Background="{StaticResource BorderBrush_}" Margin="0,16"/>

                    <!-- Ð˜Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ ÑˆÐ°Ð½Ñ -->
                    <TextBlock Text="â¤ï¸ Favorites Settings:" Foreground="{StaticResource SubtextBrush}" Margin="0,0,0,12"/>
                    <StackPanel Orientation="Horizontal" Margin="24,0,0,16">
                        <TextBlock Text="Chance to appear (%):"
                                   Foreground="{StaticResource TextBrush}"
                                   VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Width="50" Text="{Binding FavoritesPercentage, UpdateSourceTrigger=PropertyChanged}" TextAlignment="Center"
                                 Background="{StaticResource CardBrush}"
                                 Foreground="White"
                                 BorderThickness="0"
                                 Padding="4" VerticalContentAlignment="Center"/>
                    </StackPanel>

                </StackPanel>
            </ScrollViewer>

            <!-- Ð’ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ -->
            <Border Grid.Column="1" HorizontalAlignment="Center" Width="1" Background="{StaticResource BorderBrush_}" Margin="0,16"/>

            <!-- Ð¡ÐµÐºÑ†Ð¸Ñ 2: Ð¢ÐµÐ³Ð¸ Ð¸ ÐŸÐ¾Ð¸ÑÐº -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                    <RowDefinition Height="Auto"/> <!-- Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ (Chips) -->
                    <RowDefinition Height="*"/>    <!-- Ð”ÐµÑ€ÐµÐ²Ð¾ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ -->
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="0,0,0,16">
                    <TextBlock Text="ðŸ· Tags" Foreground="White" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    <DockPanel>
                        <TextBlock Text="Editing tags for:" Foreground="{StaticResource SubtextBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox ItemsSource="{Binding TagScopes}" SelectedItem="{Binding SelectedTagScopeItem}" DisplayMemberPath="DisplayName" Background="{StaticResource CardBrush}" Foreground="White" BorderThickness="0" Padding="8,4"/>
                    </DockPanel>
                </StackPanel>

                <!-- Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÐ³Ð¸ (Chips) -->
                <ItemsControl Grid.Row="1" ItemsSource="{Binding CustomTagsList}" Margin="0,0,0,16">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{StaticResource CardBrush}" CornerRadius="12" Margin="0,0,8,8" Padding="10,4,4,4">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding}" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <Button Content="âœ•" Command="{Binding DataContext.RemoveCustomTagCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Background="Transparent" Foreground="{StaticResource SubtextBrush}" BorderThickness="0" Cursor="Hand" Width="20" Height="20" FontSize="10"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Ð¢Ð•Ð“Ð˜: Ð”ÐµÑ€ÐµÐ²Ð¾ (Expander) -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding CategoriesTree}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Expander Style="{StaticResource CustomExpanderStyle}" Margin="0,0,0,8">
                                    <Expander.Header>
                                        <StackPanel Orientation="Horizontal" Margin="4,2">
                                            <CheckBox Style="{StaticResource ToggleSwitchStyle}" IsChecked="{Binding IsAllSelected}" VerticalAlignment="Center" Margin="0,0,12,0" Content=" "/>
                                            <TextBlock Text="{Binding CategoryName}" FontWeight="SemiBold" VerticalAlignment="Center" FontSize="15" Foreground="White"/>
                                        </StackPanel>
                                    </Expander.Header>
                                    <ItemsControl ItemsSource="{Binding Tags}" Margin="48,12,0,0">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <ToggleButton Content="{Binding Name}" IsChecked="{Binding IsSelected}" 
                                                              Style="{StaticResource OutlinedTagToggleStyle}" Margin="0,0,6,6"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Expander>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Border>
</UserControl>
