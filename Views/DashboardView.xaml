<UserControl x:Class="Wolpope.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource SurfaceBrush}">
    <Border Padding="32">
        <DockPanel>


            <!-- Нижняя панель управления -->
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,24,0,0">
                <Grid Width="160" Height="70" Margin="0,0,16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <Grid Grid.Column="0" Width="70" Height="70" Margin="0,0,16,0">
                        <Ellipse Stroke="{StaticResource CardBrush}" StrokeThickness="6" />
                        <Button Style="{StaticResource PlayPauseBtnStyle}" Command="{Binding StartCommand}" 
                                Content="▶" Visibility="{Binding IsRunning, Converter={StaticResource InvBoolToVis}}"/>
                        <Button Style="{StaticResource PlayPauseBtnStyle}" Command="{Binding StopCommand}" 
                                Content="⏸" Visibility="{Binding IsRunning, Converter={StaticResource BoolToVis}}"/>
                    </Grid>
                    
                    <Grid Grid.Column="1" Width="70" Height="70">
                        <Ellipse Stroke="{StaticResource CardBrush}" StrokeThickness="6" />
                        <Button Style="{StaticResource PlayPauseBtnStyle}" Command="{Binding SkipCommand}" 
                                Content="⏭" ToolTip="Next Wallpaper"/>
                    </Grid>
                </Grid>
                
                <StackPanel VerticalAlignment="Center" Margin="8,0" Width="250">
                    <ProgressBar Minimum="0" Maximum="100" Value="{Binding TimeProgress}" Width="250" Margin="0,0,0,4" Style="{StaticResource DarkProgressBarStyle}"/>
                    <TextBlock Text="{Binding StatusText}" FontSize="12" Foreground="{StaticResource SubtextBrush}" HorizontalAlignment="Center" TextAlignment="Center" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" ToolTip="{Binding StatusText}"/>
                </StackPanel>
            </StackPanel>

            <!-- Вкладки экранов (мониторы / лок скрин) -->
            <ListBox ItemsSource="{Binding PreviewTabs}" SelectedItem="{Binding SelectedPreviewTab, Mode=TwoWay}" 
                     Background="Transparent" BorderThickness="0" Margin="0,0,0,16"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Disabled">
                <ListBox.Style>
                    <Style TargetType="ListBox">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsPreviewSwitcherVisible}" Value="False">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.Style>
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border x:Name="Bd" Background="{StaticResource CardBrush}" CornerRadius="8" Padding="12,6" Margin="0,0,8,0" Cursor="Hand" BorderThickness="1" BorderBrush="Transparent">
                                        <TextBlock x:Name="Txt" Text="{Binding Title}" Foreground="{StaticResource SubtextBrush}" FontWeight="SemiBold"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource CardBrush}"/>
                                            <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                            <Setter TargetName="Txt" Property="Foreground" Value="White"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Opacity" Value="0.8"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>

            <!-- Превью обоев -->
            <Border CornerRadius="20" Background="{StaticResource CardBrush}" ClipToBounds="True">
                <Grid>
                    <TextBlock Text="Your current wallpaper will appear here" 
                               Foreground="{StaticResource SubtextBrush}" 
                               HorizontalAlignment="Center" VerticalAlignment="Center" 
                               FontStyle="Italic" FontSize="16">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentWallpaperPath}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding CurrentWallpaperPath}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Image Source="{Binding CurrentWallpaperPath}" Stretch="UniformToFill"/>
                    <ToggleButton Content="❤" HorizontalAlignment="Right" VerticalAlignment="Top" 
                                  IsChecked="{Binding IsCurrentWallpaperFavorite, Mode=TwoWay}"
                                  Command="{Binding AddToFavoritesCommand}"
                                  Margin="16" Height="40" Width="40" Style="{StaticResource HeartToggleStyle}" />
                </Grid>
            </Border>
        </DockPanel>
    </Border>
</UserControl>
